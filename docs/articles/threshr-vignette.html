<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis • threshr</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">threshr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/threshr-vignette.html">Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/threshr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</h1>
                        <h4 data-toc-skip class="author">Paul J.
Northrop</h4>
            
            <h4 data-toc-skip class="date">2025-10-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/threshr/blob/HEAD/vignettes/threshr-vignette.Rmd"><code>vignettes/threshr-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>threshr-vignette.Rmd</code></div>
    </div>

    
    
<p>The <em>threshr</em> package deals primarily with the selection of
thresholds for use in extreme value modelling. The underlying
methodology is described in detail in <a href="https://doi.org/10.1111/rssc.12159" class="external-link">Northrop, Attalides, and
Jonathan (2017)</a>. Bayesian leave-one-out cross-validation is used to
compare the extreme value predictive performance resulting from each of
a set of thresholds. This assesses the trade-off between the model
mis-specification bias that results from an inappropriately low
threshold and the loss of precision of estimation from an unnecessarily
high threshold. There many other approaches to address this
bias-variance trade-off. See <span class="citation">Scarrott and
MacDonald (2012)</span> for a review.</p>
<p>At the moment only the simplest case, where the data can be treated
as independent identically distributed observations, is considered. In
this case the model used is a combination of a binomial distribution for
the number of <em>exceedances</em> of a given threshold and a
generalized Pareto (GP) distribution for the amounts, the <em>threshold
excesses</em> by which exceedances lie above a threshold. We refer to
this as a binomial-GP model. Future releases of <strong>threshr</strong>
will tackle more general situations.</p>
<p>We use the function <code>ithresh</code> to compare the predictive
performances of each of a set of user-supplied thresholds. We also
perform predictive inferences for future extreme values, using the
<code>predict</code> method for objects returned from
<code>ithresh</code>. These inferences can be based either on a single
threshold or on a weighted average of inferences from multiple
thresholds. The weighting reflects an estimated measure of the
predictive performance of the threshold and can also incorporate
user-supplied prior probabilities for each threshold.</p>
<p>A traditional simple graphical method to inform threshold selection
is to plot estimates of, and confidence intervals for, the GP shape
parameter <span class="math inline">\(\xi\)</span> over a range of
thresholds. This plot is used to choose a threshold above which the
underlying GP shape parameter may be approximately constant. See Chapter
4 of <span class="citation">Coles (2001)</span> for details. Identifying
a single threshold using this method is usually unrealistic but the plot
can point to a range of thresholds that merit more sophisticated
analysis. The <strong>threshr</strong> function <code>stability</code>
produces this type of plot.</p>
<div class="section level2">
<h2 id="cross-validatory-predictive-performance-for-i-i-d--data">Cross-validatory predictive performance for i.i.d. data<a class="anchor" aria-label="anchor" href="#cross-validatory-predictive-performance-for-i-i-d--data"></a>
</h2>
<p>We provide a brief outline of the methodology underlying
<code>ithresh</code>. For full details see <span class="citation">Northrop, Attalides, and Jonathan (2017)</span>.
Consider a set of <em>training thresholds</em> <span class="math inline">\(u_1, \ldots, u_k\)</span>. The <em>validation
threshold</em> <span class="math inline">\(v = u_k\)</span> defines
validation data: indicators of whether or not an observation exceeds
<span class="math inline">\(v\)</span> and, if it does, the amount by
which <span class="math inline">\(v\)</span> is exceeded. For a given
training threshold leave-one-out cross-validation estimates the quality
of predictive inference for each of the individual omitted samples based
on Bayesian inferences from a binomial-GP model. Importance sampling is
used to reduce computation time: only two posterior samples are required
for each training threshold. Simulation from the posterior distributions
of the binomial-GP parameters is performed using the
<strong>revdbayes</strong> package <span class="citation">(Northrop
2017)</span>.</p>
<p>In the first release of <strong>threshr</strong> the binomial
probability is assumed to be independent of the parameters of the GP
distribution <em>a priori</em>. This will be relaxed in a later release.
The user can choose from a selection of in-built prior distributions and
may specify their own prior for GP models parameters. By default the
Beta(1/2, 1/2) Jeffreys’ prior is used for the threshold exceedance
probability of the binomial distribution and a generalization of the
Maximal Data Information (MDI) prior is used for the GP parameters. See
the documentation of <code>ithresh</code> and <span class="citation">Northrop, Attalides, and Jonathan (2017)</span> for
details of the latter.</p>
<p>We use the storm peak significant wave heights datasets analysed in
<span class="citation">Northrop, Attalides, and Jonathan (2017)</span>
from the Gulf of Mexico (<code>gom</code>, with 315 observations) and
the northern North Sea (<code>ns</code>, with 628 observations) to
illustrate the code. There should be enough exceedances of the
validation threshold <span class="math inline">\(v = u_k\)</span> to
enable the predictive performances of the training thresholds to be
compared. <span class="citation">Jonathan and Ewans (2013)</span>
recommend that when making inferences about a GP distribution there
should be no fewer than 50 exceedances. We bear this rule-of-thumb in
mind when setting the vectors of training thresholds below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paulnorthrop.github.io/threshr/" class="external-link">threshr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the size of the posterior sample simulated at each threshold</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co">## North Sea significant wave heights</span></span>
<span></span>
<span><span class="co"># Set a vector of training thresholds</span></span>
<span><span class="va">u_vec_ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ns</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.85</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Compare the predictive performances of the training thresholds</span></span>
<span><span class="va">ns_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ithresh.html">ithresh</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ns</span>, u_vec <span class="op">=</span> <span class="va">u_vec_ns</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Gulf of Mexico significant wave heights</span></span>
<span></span>
<span><span class="co"># Set a vector of training thresholds</span></span>
<span><span class="va">u_vec_gom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gom</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.8</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Compare the predictive performances of the training thresholds</span></span>
<span><span class="va">gom_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ithresh.html">ithresh</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gom</span>, u_vec <span class="op">=</span> <span class="va">u_vec_gom</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>The default plot method for objects returned by <code>ithresh</code>
is of the estimated measures of predictive performance, normalized to
sum to 1, against training threshold. See equations (7) and (14) of
<span class="citation">Northrop, Attalides, and Jonathan
(2017)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ns_cv</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"North Sea : significant wave height / m"</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gom_cv</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Gulf of Mexico: significant wave height / m"</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"><img src="threshr-vignette_files/figure-html/unnamed-chunk-4-2.png" width="672" style="display: block; margin: auto;"></p>
<p>The summary method identifies which training threshold is estimated
to perform best.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ns_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt;        v v quantile best u best u quantile index of u_vec</span></span>
<span><span class="co">#&gt; 1 5.6972         85  2.204              25              4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gom_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt;       v v quantile best u best u quantile index of u_vec</span></span>
<span><span class="co">#&gt; 1 4.607         80 3.3878              60             11</span></span></code></pre></div>
<p>The plot method can also produce a plot of the posterior sample of
the GP parameters generated using a training threshold chosen by the
user, e.g. the argument <code>which_u = 5</code> specifies the fifth
element of the vector of training thresholds, or using the best
threshold, as below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot of Generalized Pareto posterior sample at the best threshold</span></span>
<span><span class="co"># (based on the lowest validation threshold)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ns_cv</span>, which_u <span class="op">=</span> <span class="st">"best"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gom_cv</span>, which_u <span class="op">=</span> <span class="st">"best"</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-6-1.png" width="331.2"><img src="threshr-vignette_files/figure-html/unnamed-chunk-6-2.png" width="331.2"></p>
</div>
<div class="section level2">
<h2 id="predictive-inference-for-future-extremes">Predictive inference for future extremes<a class="anchor" aria-label="anchor" href="#predictive-inference-for-future-extremes"></a>
</h2>
<p>Let <span class="math inline">\(M_N\)</span> denote the largest value
to be observed in a time period of length <span class="math inline">\(N\)</span> years. The predict method for objects
returned from <code>ithresh</code> performs predictive inference for
<span class="math inline">\(M_N\)</span> based either on a single
training threshold or on a weighted average of inferences from multiple
training thresholds.</p>
<div class="section level3">
<h3 id="single-training-threshold">Single training threshold<a class="anchor" aria-label="anchor" href="#single-training-threshold"></a>
</h3>
<p>By default the threshold that is estimated to perform best is used. A
different threshold can be selected using the argument
<code>which_u</code>. Using <code>type = "d"</code> produces the
predictive density function. The values of <span class="math inline">\(N\)</span> can be set using <code>n_years</code>.
The default is <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictive distribution function</span></span>
<span><span class="va">best_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gom_cv</span>, n_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"d"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">best_p</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="inferences-averaged-over-multiple-thresholds">Inferences averaged over multiple thresholds<a class="anchor" aria-label="anchor" href="#inferences-averaged-over-multiple-thresholds"></a>
</h3>
<p>This option is selected using <code>which_u = "all"</code>. The user
can specify a prior probability for each threshold using
<code>u_prior</code>. The default is that all thresholds receive equal
prior probability, in which case the weights applied to individual
training thresholds are those displayed in the threshold diagnostic plot
above. The default, <code>type = "p"</code> produces the predictive
distribution function. If <code>which_u = "all"</code> then
<code>n_years</code> must have length one. The default is <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### All thresholds plus weighted average of inferences over all thresholds</span></span>
<span><span class="va">all_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gom_cv</span>, which_u <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">all_p</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>As we expect, the estimated distribution function obtained by the
weighted average over all thresholds lies between the pointwise envelope
of the curves of the individual thresholds.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Coles2001" class="csl-entry">
Coles, S. G. 2001. <em>An Introduction to Statistical Modelling of
Extreme Values</em>. London: Springer.
</div>
<div id="ref-JE2013" class="csl-entry">
Jonathan, P., and K. Ewans. 2013. <span>“Statistical Modelling of
Extreme Ocean Environments for Marine Design : A Review.”</span>
<em>Ocean Engineering</em> 62: 91–109. <a href="https://doi.org/10.1016/j.oceaneng.2013.01.004" class="external-link">https://doi.org/10.1016/j.oceaneng.2013.01.004</a>.
</div>
<div id="ref-revdbayes" class="csl-entry">
Northrop, P. J. 2017. <em><span class="nocase">r</span>evdbayes:
Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis</em>. <a href="https://CRAN.R-project.org/package=revdbayes" class="external-link">https://CRAN.R-project.org/package=revdbayes</a>.
</div>
<div id="ref-NAJ2017" class="csl-entry">
Northrop, P. J., N. Attalides, and P. Jonathan. 2017.
<span>“Cross-Validatory Extreme Value Threshold Selection and
Uncertainty with Application to Ocean Storm Severity.”</span>
<em>Journal of the Royal Statistical Society: Series C (Applied
Statistics)</em> 66 (1): 93–120. <a href="https://doi.org/10.1111/rssc.12159" class="external-link">https://doi.org/10.1111/rssc.12159</a>.
</div>
<div id="ref-SM2012" class="csl-entry">
Scarrott, C., and A. MacDonald. 2012. <span>“A Review of Extreme Value
Threshold Estimation and Uncertainty Quantification.”</span> <em>REVSTAT
- Statistical Journal</em> 10 (1): 33–60.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Nicolas Attalides.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
