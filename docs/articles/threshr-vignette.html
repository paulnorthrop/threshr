<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis • threshr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis">
<meta property="og:description" content="threshr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">threshr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/threshr-vignette.html">Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paulnorthrop/threshr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</h1>
                        <h4 class="author">Paul J. Northrop</h4>
            
            <h4 class="date">2020-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/threshr/blob/master/vignettes/threshr-vignette.Rmd"><code>vignettes/threshr-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>threshr-vignette.Rmd</code></div>

    </div>

    
    
<p>The <em>threshr</em> package deals primarily with the selection of thresholds for use in extreme value modelling. The underlying methodology is described in detail in <a href="https://doi.org/10.1111/rssc.12159">Northrop, Attalides, and Jonathan (2017)</a>. Bayesian leave-one-out cross-validation is used to compare the extreme value predictive performance resulting from each of a set of thresholds. This assesses the trade-off between the model mis-specification bias that results from an inappropriately low threshold and the loss of precision of estimation from an unnecessarily high threshold. There many other approaches to address this bias-variance trade-off. See <span class="citation">Scarrott and MacDonald (2012)</span> for a review.</p>
<p>At the moment only the simplest case, where the data can be treated as independent identically distributed observations, is considered. In this case the model used is a combination of a binomial distribution for the number of <em>exceedances</em> of a given threshold and a generalized Pareto (GP) distribution for the amounts, the <em>threshold excesses</em> by which exceedances lie above a threshold. We refer to this as a binomial-GP model. Future releases of <strong>threshr</strong> will tackle more general situations.</p>
<p>We use the function <code>ithresh</code> to compare the predictive performances of each of a set of user-supplied thresholds. We also perform predictive inferences for future extreme values, using the <code>predict</code> method for objects returned from <code>ithresh</code>. These inferences can be based either on a single threshold or on a weighted average of inferences from multiple thresholds. The weighting reflects an estimated measure of the predictive performance of the threshold and can also incorporate user-supplied prior probabilities for each threshold.</p>
<p>A traditional simple graphical method to inform threshold selection is to plot estimates of, and confidence intervals for, the GP shape parameter <span class="math inline">\(\xi\)</span> over a range of thresholds. This plot is used to choose a threshold above which the underlying GP shape parameter may be approximately constant. See Chapter 4 of <span class="citation">Coles (2001)</span> for details. Identifying a single threshold using this method is usually unrealistic but the plot can point to a range of thresholds that merit more sophisticated analysis. The <strong>threshr</strong> function <code>stability</code> produces this type of plot.</p>
<div id="cross-validatory-predictive-performance-for-i-i-d--data" class="section level2">
<h2 class="hasAnchor">
<a href="#cross-validatory-predictive-performance-for-i-i-d--data" class="anchor"></a>Cross-validatory predictive performance for i.i.d. data</h2>
<p>We provide a brief outline of the methodology underlying <code>ithresh</code>. For full details see <span class="citation">Northrop, Attalides, and Jonathan (2017)</span>. Consider a set of <em>training thresholds</em> <span class="math inline">\(u_1, \ldots, u_k\)</span>. The <em>validation threshold</em> <span class="math inline">\(v = u_k\)</span> defines validation data: indicators of whether or not an observation exceeds <span class="math inline">\(v\)</span> and, if it does, the amount by which <span class="math inline">\(v\)</span> is exceeded. For a given training threshold leave-one-out cross-validation estimates the quality of predictive inference for each of the individual omitted samples based on Bayesian inferences from a binomial-GP model. Importance sampling is used to reduce computation time: only two posterior samples are required for each training threshold. Simulation from the posterior distributions of the binomial-GP parameters is performed using the <strong>revdbayes</strong> package <span class="citation">(Northrop 2017)</span>.</p>
<p>In the first release of <strong>threshr</strong> the binomial probability is assumed to be independent of the parameters of the GP distribution <em>a priori</em>. This will be relaxed in a later release. The user can choose from a selection of in-built prior distributions and may specify their own prior for GP models parameters. By default the Beta(1/2, 1/2) Jeffreys’ prior is used for the threshold exceedance probability of the binomial distribution and a generalization of the Maximal Data Information (MDI) prior is used for the GP parameters. See the documentation of <code>ithresh</code> and <span class="citation">Northrop, Attalides, and Jonathan (2017)</span> for details of the latter.</p>
<p>We use the storm peak significant wave heights datasets analysed in <span class="citation">Northrop, Attalides, and Jonathan (2017)</span> from the Gulf of Mexico (<code>gom</code>, with 315 observations) and the northern North Sea (<code>ns</code>, with 628 observations) to illustrate the code. There should be enough exceedances of the validation threshold <span class="math inline">\(v = u_k\)</span> to enable the predictive performances of the training thresholds to be compared. <span class="citation">Jonathan and Ewans (2013)</span> recommend that when making inferences about a GP distribution there should be no fewer than 50 exceedances. We bear this rule-of-thumb in mind when setting the vectors of training thresholds below.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">threshr</span>)

<span class="co"># Set the size of the posterior sample simulated at each threshold</span>
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">10000</span>

<span class="co">## North Sea significant wave heights</span>

<span class="co"># Set a vector of training thresholds</span>
<span class="no">u_vec_ns</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">ns</span>, <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.85</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.05</span>))
<span class="co"># Compare the predictive performances of the training thresholds</span>
<span class="no">ns_cv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ithresh.html">ithresh</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">ns</span>, <span class="kw">u_vec</span> <span class="kw">=</span> <span class="no">u_vec_ns</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n</span>)

<span class="co">## Gulf of Mexico significant wave heights</span>

<span class="co"># Set a vector of training thresholds</span>
<span class="no">u_vec_gom</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">gom</span>, <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.05</span>))
<span class="co"># Compare the predictive performances of the training thresholds</span>
<span class="no">gom_cv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ithresh.html">ithresh</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">gom</span>, <span class="kw">u_vec</span> <span class="kw">=</span> <span class="no">u_vec_gom</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n</span>)</pre></body></html></div>
<p>The default plot method for objects returned by <code>ithresh</code> is of the estimated measures of predictive performance, normalized to sum to 1, against training threshold. See equations (7) and (14) of <span class="citation">Northrop, Attalides, and Jonathan (2017)</span>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ns_cv</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">cex.axis</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="st">"North Sea : significant wave height / m"</span>, <span class="kw">side</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">line</span> <span class="kw">=</span> <span class="fl">2.5</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">gom_cv</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">cex.axis</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="st">"Gulf of Mexico: significant wave height / m"</span>, <span class="kw">side</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">line</span> <span class="kw">=</span> <span class="fl">2.5</span>)</pre></body></html></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"><img src="threshr-vignette_files/figure-html/unnamed-chunk-4-2.png" width="672" style="display: block; margin: auto;"></p>
<p>The summary method identifies which training threshold is estimated to perform best.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ns_cv</span>)
<span class="co">#&gt;        v v quantile best u best u quantile index of u_vec</span>
<span class="co">#&gt; 1 5.6972         85  2.204              25              4</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">gom_cv</span>)
<span class="co">#&gt;       v v quantile best u best u quantile index of u_vec</span>
<span class="co">#&gt; 1 4.607         80 3.3878              60             11</span></pre></body></html></div>
<p>The plot method can also produce a plot of the posterior sample of the GP parameters generated using a training threshold chosen by the user, e.g. the argument <code>which_u = 5</code> specifies the fifth element of the vector of training thresholds, or using the best threshold, as below.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Plot of Generalized Pareto posterior sample at the best threshold</span>
<span class="co"># (based on the lowest validation threshold)</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ns_cv</span>, <span class="kw">which_u</span> <span class="kw">=</span> <span class="st">"best"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">gom_cv</span>, <span class="kw">which_u</span> <span class="kw">=</span> <span class="st">"best"</span>)</pre></body></html></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-6-1.png" width="331.2"><img src="threshr-vignette_files/figure-html/unnamed-chunk-6-2.png" width="331.2"></p>
</div>
<div id="predictive-inference-for-future-extremes" class="section level2">
<h2 class="hasAnchor">
<a href="#predictive-inference-for-future-extremes" class="anchor"></a>Predictive inference for future extremes</h2>
<p>Let <span class="math inline">\(M_N\)</span> denote the largest value to be observed in a time period of length <span class="math inline">\(N\)</span> years. The predict method for objects returned from <code>ithresh</code> performs predictive inference for <span class="math inline">\(M_N\)</span> based either on a single training threshold or on a weighted average of inferences from multiple training thresholds.</p>
<div id="single-training-threshold" class="section level3">
<h3 class="hasAnchor">
<a href="#single-training-threshold" class="anchor"></a>Single training threshold</h3>
<p>By default the threshold that is estimated to perform best is used. A different threshold can be selected using the argument <code>which_u</code>. Using <code>type = "d"</code> produces the predictive density function. The values of <span class="math inline">\(N\)</span> can be set using <code>n_years</code>. The default is <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Predictive distribution function</span>
<span class="no">best_p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">gom_cv</span>, <span class="kw">n_years</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>, <span class="fl">1000</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"d"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">best_p</span>)</pre></body></html></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="inferences-averaged-over-multiple-thresholds" class="section level3">
<h3 class="hasAnchor">
<a href="#inferences-averaged-over-multiple-thresholds" class="anchor"></a>Inferences averaged over multiple thresholds</h3>
<p>This option is selected using <code>which_u = "all"</code>. The user can specify a prior probability for each threshold using <code>u_prior</code>. The default is that all thresholds receive equal prior probability, in which case the weights applied to individual training thresholds are those displayed in the threshold diagnostic plot above. The default, <code>type = "p"</code> produces the predictive distribution function. If <code>which_u = "all"</code> then <code>n_years</code> must have length one. The default is <span class="math inline">\(N = 100\)</span>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">### All thresholds plus weighted average of inferences over all thresholds</span>
<span class="no">all_p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">gom_cv</span>, <span class="kw">which_u</span> <span class="kw">=</span> <span class="st">"all"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">all_p</span>)</pre></body></html></div>
<p><img src="threshr-vignette_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>As we expect, the estimated distribution function obtained by the weighted average over all thresholds lies between the pointwise envelope of the curves of the individual thresholds.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references">
<div id="ref-Coles2001">
<p>Coles, S. G. 2001. <em>An Introduction to Statistical Modelling of Extreme Values</em>. London: Springer.</p>
</div>
<div id="ref-JE2013">
<p>Jonathan, P., and K. Ewans. 2013. “Statistical Modelling of Extreme Ocean Environments for Marine Design : A Review.” <em>Ocean Engineering</em> 62: 91–109. <a href="https://doi.org/10.1016/j.oceaneng.2013.01.004">https://doi.org/10.1016/j.oceaneng.2013.01.004</a>.</p>
</div>
<div id="ref-revdbayes">
<p>Northrop, P. J. 2017. <em>revdbayes: Ratio-of-Uniforms Sampling for Bayesian Extreme Value Analysis</em>. <a href="https://CRAN.R-project.org/package=revdbayes">https://CRAN.R-project.org/package=revdbayes</a>.</p>
</div>
<div id="ref-NAJ2017">
<p>Northrop, P. J., N. Attalides, and P. Jonathan. 2017. “Cross-Validatory Extreme Value Threshold Selection and Uncertainty with Application to Ocean Storm Severity.” <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em> 66 (1): 93–120. <a href="https://doi.org/10.1111/rssc.12159">https://doi.org/10.1111/rssc.12159</a>.</p>
</div>
<div id="ref-SM2012">
<p>Scarrott, C., and A. MacDonald. 2012. “A Review of Extreme Value Threshold Estimation and Uncertainty Quantification.” <em>REVSTAT - Statistical Journal</em> 10 (1): 33–60. <a href="https://www.ine.pt/revstat/pdf/rs120102.pdf">https://www.ine.pt/revstat/pdf/rs120102.pdf</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul J. Northrop, Nicolas Attalides.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
