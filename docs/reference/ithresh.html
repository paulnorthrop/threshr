<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Threshold selection in the i.i.d. case (peaks over threshold) — ithresh • threshr</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Threshold selection in the i.i.d. case (peaks over threshold) — ithresh"><meta name="description" content="Produces a diagnostic plot to assist in the selection of an extreme value
threshold in the case where the data can be treated as independent and
identically distributed (i.i.d.) observations.  For example, it could be
that these observations are the cluster maxima resulting from the
declustering of time series data.  The predictive ability of models
fitted using each of a user-supplied set of thresholds is assessed using
leave-one-out cross-validation in a Bayesian setup.
These models are based on a Generalized Pareto (GP) distribution for
threshold excesses and a binomial model for the probability of threshold
exceedance.  See Northrop et al. (2017) for details."><meta property="og:description" content="Produces a diagnostic plot to assist in the selection of an extreme value
threshold in the case where the data can be treated as independent and
identically distributed (i.i.d.) observations.  For example, it could be
that these observations are the cluster maxima resulting from the
declustering of time series data.  The predictive ability of models
fitted using each of a user-supplied set of thresholds is assessed using
leave-one-out cross-validation in a Bayesian setup.
These models are based on a Generalized Pareto (GP) distribution for
threshold excesses and a binomial model for the probability of threshold
exceedance.  See Northrop et al. (2017) for details."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">threshr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/threshr-vignette.html">Introducing threshr: Threshold Selection and Uncertainty for Extreme Value Analysis</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/threshr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Threshold selection in the i.i.d. case (peaks over threshold)</h1>
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/threshr/blob/HEAD/R/ithresh.R"><code>R/ithresh.R</code></a></small>
      <div class="d-none name"><code>ithresh.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produces a diagnostic plot to assist in the selection of an extreme value
threshold in the case where the data can be treated as independent and
identically distributed (i.i.d.) observations.  For example, it could be
that these observations are the cluster maxima resulting from the
declustering of time series data.  The predictive ability of models
fitted using each of a user-supplied set of thresholds is assessed using
leave-one-out cross-validation in a Bayesian setup.
These models are based on a Generalized Pareto (GP) distribution for
threshold excesses and a binomial model for the probability of threshold
exceedance.  See Northrop et al. (2017) for details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ithresh</span><span class="op">(</span><span class="va">data</span>, <span class="va">u_vec</span>, <span class="va">...</span>, n_v <span class="op">=</span> <span class="fl">1</span>, npy <span class="op">=</span> <span class="cn">NULL</span>, use_rcpp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A numeric vector of observations.  Any missing values will
be removed.  The argument <code>npy</code> (see below) may be supplied
as an attribute of <code>data</code> using <code>attr(data, "npy") &lt;- value</code>,
where <code>value</code> is the value of <code>npy</code> (see <code><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></code>).
If <code>npy</code> is supplied twice, as both <code>attr(data, "npy")</code>)
and using the <code>npy</code> argument, then the former is used.</p></dd>


<dt id="arg-u-vec">u_vec<a class="anchor" aria-label="anchor" href="#arg-u-vec"></a></dt>
<dd><p>A numeric vector. A vector of <em>training</em> thresholds
at which inferences are made from a binomial-GP model.  These could be
set at sample quantiles of  <code>data</code> using
<code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></code>.  Any duplicated values will be removed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further (optional) arguments to be passed to the
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/revdbayes-package.html" class="external-link">revdbayes</a></code> function
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code> (or <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code>),
  which use the generalized ratio-of-uniforms method to simulate from
  extreme value posterior distributions.
  In particular:</p><ul><li><p><code>n</code>. The size of the posterior sample used to perform
    predictive inference.  Default: <code>n = 1000</code>.</p></li>
<li><p><code>prior</code>. A prior for GP parameters to be passed to the
    <strong>revdbayes</strong> function <code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></code>.
    Can be either a character scalar that chooses an in-built prior,
    or a user-supplied R function or pointer to a compiled C++ function.
    See the <code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></code> documentation for details
    of the in-built priors.
    See the <strong>revdbayes</strong> vignette
    <a href="https://cran.r-project.org/package=revdbayes" class="external-link">Faster simulation
    using revdbayes</a> for information about creating
    a pointer to a C++ function.  See also the <strong>Examples</strong> section.</p>
<p>If the user supplies an R function then <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code>
    will be used for posterior simulation, rather than (the faster)
    <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code>, regardless of the input value of
    <code>use_rcpp</code>.</p>
<p>Default: <code>prior = "mdi"</code> with <code>a = 0.6</code> and <code>min_xi = -1</code>.
    This particular prior is studied in Northrop et al. (2017).</p></li>
<li><p><code>h_prior</code>. A <em>list</em> of further arguments
    (hyperparameters) for the GP prior specified in <code>prior</code>.</p></li>
<li><p><code>bin_prior</code>. A prior for the threshold exceedance probability
    \(p\) to be passed to the <strong>revdbayes</strong> function
    <code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_bin_prior.html" class="external-link">set_bin_prior</a></code>.
    Can either be a character scalar that chooses an in-built prior,
    or a user_supplied R function.</p>
<p>Default: <code>prior = "jeffreys"</code>, i.e. Beta(1/2, 1/2).</p></li>
<li><p><code>h_bin_prior</code>. A <em>list</em> of further arguments
    (hyperparameters) for the binomial prior specified in <code>bin_prior</code>.
    See the <code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_bin_prior.html" class="external-link">set_bin_prior</a></code> documentation for details
    of the in-built priors.</p></li>
<li><p><code>trans</code>. A character scalar: either <code>"none"</code> or
    <code>"BC"</code>.  See <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code> for details.
    The default is <code>"none"</code>, which is usually faster than <code>"BC"</code>.
    However, if there are very few threshold excesses then using
    <code>trans = "BC"</code> can make the optimizations involved in the
    generalized ratio-of-uniforms algorithm more stable.  If using
    <code>trans = "none"</code> produces an error for a particular posterior
    simulation then <code>trans = "BC"</code> is used instead.</p></li>
</ul></dd>


<dt id="arg-n-v">n_v<a class="anchor" aria-label="anchor" href="#arg-n-v"></a></dt>
<dd><p>A numeric scalar.
Each of the <code>n_v</code> largest values in <code>u_vec</code> will be used
(separately) as a <em>validation</em> threshold for the training thresholds
in <code>u_vec</code> that lie at or below that validation threshold.
If <code>n_v = 1</code> then all the training thresholds are used with
validation performed using the threshold <code>u_vec[length(u_vec)]</code>.
If <code>n_v = 2</code> then, in addition, the assessment is performed using
<code>u_vec[1], ..., u_vec[length(u_vec) - 1]</code> with
validation threshold <code>u_vec[length(u_vec) - 1]</code>,
and so on.</p></dd>


<dt id="arg-npy">npy<a class="anchor" aria-label="anchor" href="#arg-npy"></a></dt>
<dd><p>A numeric scalar. The mean number of observations per year
  of data, after excluding any missing values, i.e. the number of
  non-missing observations divided by total number of years of non-missing
  data.  May be supplied using as an attribute <code>attr(data, "npy")</code>
  of <code>data</code> instead.</p>
<p>The value of <code>npy</code> does not affect any calculation in
  <code>ithresh</code>, it only affects subsequent extreme value inferences using
  <code>predict.ithresh</code>.  However, setting <code>npy</code> in the call to
  <code>rpost</code>, or as an attribute of <code>data</code> avoids the need to
  supply <code>npy</code> when calling <code>predict.ithresh</code>.</p></dd>


<dt id="arg-use-rcpp">use_rcpp<a class="anchor" aria-label="anchor" href="#arg-use-rcpp"></a></dt>
<dd><p>A logical scalar.  If <code>TRUE</code> (the default) the
revdbayes function <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code> is used for
posterior simulation.  If <code>FALSE</code>, or if the user supplies an R
function to set the prior for GP parameters,
the (slower) function <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code> is used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object (list) of class <code>"ithresh"</code>, containing the
  components</p><ul><li><p><code>pred_perf</code>: A numeric matrix with <code>length(u_vec)</code>
    rows and <code>n_v</code> columns.  Each column contains the values of
    the measure of predictive performance.  Entries corresponding
    to cases where the training threshold is above the validation
    threshold will be <code>NA</code>.</p></li>
<li><p><code>u_vec</code>: The argument <code>u_vec</code> to <code>ithresh</code>.</p></li>
<li><p><code>v_vec</code>: A numeric vector.  The validation thresholds
      implied by the argument <code>n_v</code> to <code>ithresh</code>.</p></li>
<li><p><code>u_ps</code>: A numeric vector. The approximate levels of the
      sample quantiles to which the values in <code>u_vec</code> correspond,
      i.e. the approximate percentage of the data the lie at or below
      each element in <code>u_vec</code>.</p></li>
<li><p><code>v_ps</code>: A numeric vector.  The values in <code>u_ps</code>
      that correspond to the validation thresholds.</p></li>
<li><p><code>sim_vals</code>: A numeric matrix with 4 columns and
      <code>n</code> x <code>length(u_vec)</code> rows.  The \(j\)th block of
      <code>n</code> rows contains in columns 1-3 the posterior samples of
      the threshold exceedance probability, the GP scale
      parameter and the GP shape parameter respectively,
      based on training threshold <code>u_vec[j]</code>,
      and in column 4 the value of \(j\).</p></li>
<li><p><code>n</code>: A numeric scalar.  The value of <code>n</code>.</p></li>
<li><p><code>npy</code>: A numeric scalar.  The value of <code>npy</code>.</p></li>
<li><p><code>data</code>: The argument <code>data</code> to <code>ithresh</code>
      detailed above, with any missing values removed.</p></li>
<li><p><code>use_rcpp</code>: A logical scalar indicating whether
      <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code> (<code>use_rcpp = TRUE</code>) or
      <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code> (<code>use_rcpp = FALSE</code>)
      was used for posterior simulation.</p></li>
<li><p><code>for_post</code>: A list containing arguments with which
      <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code>
      (or <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code>) was called, including
      any user-supplied arguments to these functions.</p></li>
<li><p><code>call:</code> The call to <code>ithresh</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For a given threshold in <code>u_vec</code>:</p><ul><li><p>the number of values in <code>data</code> that exceed the threshold,
    and the amounts (the <em>threshold excesses</em>) by which these value
    exceed the threshold are calculated;</p></li>
<li><p><code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code>
    (or <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code>) is used to sample from the posterior
    distributions of the parameters of a GP model for the threshold
    excesses and a binomial model for the probability of threshold
    exceedance;</p></li>
<li><p>the ability of this binomial-GP model to predict data
    thresholded at the validation threshold(s) specified by <code>n_v</code> is
    assessed using leave-one-out cross-validation (the measure of
    this is given in equation (7) of Northrop et al. (2017).</p></li>
</ul><p>See Northrop et al. (2017) and the introductory threshr vignette for
  further details and examples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Northrop, P.J. and Attalides, N. (2016) Posterior propriety in
  Bayesian extreme value analyses using reference priors
  <em>Statistica Sinica</em>, <strong>26</strong>(2), 721–743
  <a href="https://doi.org/10.5705/ss.2014.034" class="external-link">doi:10.5705/ss.2014.034</a>
.</p>
<p>Northrop, P. J., Attalides, N. and Jonathan, P. (2017)
  Cross-validatory extreme value threshold selection and uncertainty
  with application to ocean storm severity.
  <em>Journal of the Royal Statistical Society Series C: Applied
  Statistics</em>, <strong>66</strong>(1), 93-120.
  <a href="https://doi.org/10.1111/rssc.12159" class="external-link">doi:10.1111/rssc.12159</a></p>
<p>Jonathan, P. and Ewans, K. (2013) Statistical modelling
  of extreme ocean environments for marine design : a review.
  <em>Ocean Engineering</em>, <strong>62</strong>, 91-109.
  <a href="https://doi.org/10.1016/j.oceaneng.2013.01.004" class="external-link">doi:10.1016/j.oceaneng.2013.01.004</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.ithresh.html">plot.ithresh</a></code> for the S3 plot method for objects of
  class <code>ithresh</code>.</p>
<p><code><a href="summary.ithresh.html">summary.ithresh</a></code> Summarizing measures of threshold
  predictive performance.</p>
<p><code><a href="predict.ithresh.html">predict.ithresh</a></code> for predictive inference for the
  largest value observed in N years.</p>
<p><code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code> in the
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/revdbayes-package.html" class="external-link">revdbayes</a></code> package for details of the arguments
  that can be passed to
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost_rcpp.html" class="external-link">rpost_rcpp</a></code>/<code><a href="https://github.com/paulnorthrop/revdbayes/reference/rpost.html" class="external-link">rpost</a></code>.</p>
<p><code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_prior.html" class="external-link">set_prior</a></code> and
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/set_bin_prior.html" class="external-link">set_bin_prior</a></code> in the
  <code><a href="https://github.com/paulnorthrop/revdbayes/reference/revdbayes-package.html" class="external-link">revdbayes</a></code> package for details of how to set a
  prior distributions for GP parameters and for the exceedance probability
  \(p\).</p>
<p><code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Note:</span></span></span>
<span class="r-in"><span><span class="co"># 1. Smoother plots result from making n larger than the default n = 1000.</span></span></span>
<span class="r-in"><span><span class="co"># 2. In some examples below validation thresholds rather higher than is</span></span></span>
<span class="r-in"><span><span class="co">#    advisable have been used, with far fewer excesses than the minimum of</span></span></span>
<span class="r-in"><span><span class="co">#    50 suggested by Jonathan and Ewans (2013).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## North Sea significant wave heights, default prior -----------------------</span></span></span>
<span class="r-in"><span><span class="co">#' # A plot akin to the top left of Figure 7 in Northrop et al. (2017)</span></span></span>
<span class="r-in"><span><span class="co">#' # ... but with fewer training thresholds</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">u_vec_ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ns</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ns_cv</span> <span class="op">&lt;-</span> <span class="fu">ithresh</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ns</span>, u_vec <span class="op">=</span> <span class="va">u_vec_ns</span>, n_v <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ns_cv</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add_legend <span class="op">=</span> <span class="cn">TRUE</span>, legend_pos <span class="op">=</span> <span class="st">"topright"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"significant wave height / m"</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ithresh-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Gulf of Mexico significant wave heights, default prior ------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">u_vec_gom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gom</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Setting a prior using its name and parameter value(s) --------------------</span></span></span>
<span class="r-in"><span><span class="co"># This example gives the same prior as the default</span></span></span>
<span class="r-in"><span><span class="va">gom_cv</span> <span class="op">&lt;-</span> <span class="fu">ithresh</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gom</span>, u_vec <span class="op">=</span> <span class="va">u_vec_gom</span>, n_v <span class="op">=</span> <span class="fl">2</span>, prior <span class="op">=</span> <span class="st">"mdi"</span>,</span></span>
<span class="r-in"><span>                  h_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Setting a user-defined (log-)prior R function ---------------------------</span></span></span>
<span class="r-in"><span><span class="co"># This example also gives the same prior as the default</span></span></span>
<span class="r-in"><span><span class="co"># (It will take longer to run than the example above because ithresh detects</span></span></span>
<span class="r-in"><span><span class="co">#  that the prior is an R function and sets use_rcpp to FALSE.)</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">user_prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">a</span>, <span class="va">min_xi</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">min_xi</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">user_bin_prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">ab</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">p</span>, shape1 <span class="op">=</span> <span class="va">ab</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, shape2 <span class="op">=</span> <span class="va">ab</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">gom_cv</span> <span class="op">&lt;-</span> <span class="fu">ithresh</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gom</span>, u_vec <span class="op">=</span> <span class="va">u_vec_gom</span>, n_v <span class="op">=</span> <span class="fl">2</span>, prior <span class="op">=</span> <span class="va">user_prior</span>,</span></span>
<span class="r-in"><span>                  h_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>, bin_prior <span class="op">=</span> <span class="va">user_bin_prior</span>,</span></span>
<span class="r-in"><span>                  h_bin_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co">## Setting a user-defined (log-)prior (pointer to a) C++ function ----------</span></span></span>
<span class="r-in"><span><span class="co"># We make use of a C++ function and function create_prior_xptr() to create</span></span></span>
<span class="r-in"><span><span class="co"># the required pointer from the revdbayes package</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prior_ptr</span> <span class="op">&lt;-</span> <span class="fu">revdbayes</span><span class="fu">::</span><span class="fu"><a href="https://github.com/paulnorthrop/revdbayes/reference/create_prior_xptr.html" class="external-link">create_prior_xptr</a></span><span class="op">(</span><span class="st">"gp_flat"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gom_cv</span> <span class="op">&lt;-</span> <span class="fu">ithresh</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gom</span>, u_vec <span class="op">=</span> <span class="va">u_vec_gom</span>, n_v <span class="op">=</span> <span class="fl">2</span>, prior <span class="op">=</span> <span class="va">prior_ptr</span>,</span></span>
<span class="r-in"><span>                  h_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min_xi <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Nicolas Attalides.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

